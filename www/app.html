<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" href="/favicon.svg" />
    <link rel="stylesheet" href="/app.css" />
    <link href="https://cdn.tailwindcss.com" rel="stylesheet" />
    <script
      defer
      src="https://webrtc.github.io/adapter/adapter-latest.js"
    ></script>
    <script defer src="/socket.io/socket.io.js"></script>
    <script defer src="/vue.global.prod.js"></script>
    <script defer src="app.js"></script>
    <script defer src="webrtc.js"></script>
    <title>Talk - Free video calling for the web</title>
  </head>

  <body>
    <section id="blanket"></section>
    <section id="videos"></section>

    <main id="app">
      <div id="appWrap" v-bind:style="'display:block;'">
        <div
          id="intro"
          v-if="!callInitiated && !showChat && !showSettings"
          class="max-w-2xl mx-auto mt-16 p-8 bg-white rounded-2xl shadow-lg"
        >
          <h3 class="text-6xl font-bold text-[#0066FF] text-center mb-16">
            Spend Time Together.
          </h3>
          <p class="text-gray-600 text-lg mb-8 text-center">
            Connect instantly with secure, crystal-clear video calls - no signup
            needed!
          </p>
          <p class="mb-8">
            <label
              v-bind:class="['block mb-2 text-gray-700', (nameError && !name ? 'text-red-600' : '')]"
            >
              What should we call you?
            </label>
            <input
              type="text"
              v-model="name"
              v-on:keyup="updateName"
              placeholder="Your name"
              class="w-full p-4 text-lg border border-gray-200 rounded-xl focus:outline-none focus:border-[#0066FF] focus:ring-2 focus:ring-[#0066FF]/20 transition-all duration-300"
            />
          </p>
          <br />

          <div class="footer">
            <button
              v-on:click="initiateCall"
              class="w-full bg-[#0066FF] text-white text-lg font-medium py-4 rounded-xl hover:bg-blue-700 transition-colors duration-300 shadow-lg hover:shadow-xl"
            >
              Proceed
            </button>
          </div>
        </div>

        <div id="callFeedbackWrap" v-if="callEnded">
          <div id="callFeedback">
            <div class="bold">
              Your call has been disconnected. You can now close this window.
            </div>
            <br />

            <div id="feedbackWrap">
              <div class="question italic">How was the quality of call?</div>
              <div class="thankYou bold">Thank you for your feedback</div>
              <div id="feedbackButtons">
                <button
                  data-cabin-event="call-quality-nah"
                  v-on:click="onCallFeedback"
                >
                  üòü<br />Nah!
                </button>
                <button
                  data-cabin-event="call-quality-meh"
                  v-on:click="onCallFeedback"
                >
                  üòê<br />Meh!
                </button>
                <button
                  data-cabin-event="call-quality-yay"
                  v-on:click="onCallFeedback"
                >
                  üòÄ<br />Yay!
                </button>
              </div>
            </div>
          </div>
        </div>

        <div id="chatWrap" v-if="showChat">
          <div id="chats" ref="chatContainer">
            <div class="chat" v-for="(chat, i) in chats" v-bind:key="i">
              <span class="name">{{chat.name}}</span>
              <span class="date light">
                &middot; {{formatDate(chat.date)}}</span
              >
              <div class="message" v-html="linkify(chat.message)"></div>
            </div>
            <div id="noChat" class="light" v-if="!chats.length">
              <small>No chat messages.</small>
            </div>
          </div>
          <div id="composeBox">
            <div id="placeholder" v-if="typing.length <= 0">
              Type message...
            </div>
            <div
              id="compose"
              contenteditable="true"
              v-on:keydown.enter="sendChat"
              v-on:input="edit($event)"
              v-on:paste="paste($event)"
            ></div>
          </div>
          <small class="light">Press enter to submit</small>
        </div>

        <div id="settings" v-if="showSettings">
          <div id="name" class="label">
            <span>Name:</span>
            <input
              type="text"
              placeholder="Enter your name"
              v-model="name"
              v-on:keyup="updateNameAndPublish"
            />
          </div>
          <hr class="separator" />

          <div class="label">Camera üìπ</div>
          <div
            v-for="(videoDevice, i) in videoDevices"
            v-bind:key="videoDevice.deviceId"
          >
            <div
              v-bind:class="'link indent '+(selectedVideoDeviceId === videoDevice.deviceId ? 'active' : '')"
              v-on:click="changeCamera(videoDevice.deviceId)"
            >
              {{videoDevice.label}}
            </div>
          </div>
          <hr class="separator" />

          <div class="label">Microphone üéôÔ∏è</div>
          <div
            v-for="(audioDevice, i) in audioDevices"
            v-bind:key="audioDevice.deviceId"
          >
            <div
              v-bind:class="'link indent '+(selectedAudioDeviceId === audioDevice.deviceId ? 'active' : '')"
              v-on:click="changeMicrophone(audioDevice.deviceId)"
            >
              {{audioDevice.label}}
            </div>
          </div>
          <hr class="separator" />

          <div class="link" v-on:click="copyURL">
            {{copyText || "Copy room link"}}
          </div>
          <hr class="separator" />
          <div class="link" v-on:click="toggleSelfVideoMirror">
            Mirror / Unmirror
            <small class="light">(self-view)</small>
          </div>
        </div>

        <div id="actionsWrap" v-if="callInitiated">
          <div id="actions">
            <button
              v-bind:class="'icon-mic'+(audioEnabled ? '' : '-off')"
              v-on:click="audioToggle"
            ></button>
            <button
              v-bind:class="'icon-video'+(videoEnabled ? '' : '-off')"
              v-on:click="videoToggle"
            ></button>
            <button
              v-bind:class="'icon-message-square '+(showChat ? 'active' : '')"
              v-on:click="showChat = !showChat"
            ></button>
            <button
              v-if="!isMobileDevice"
              v-bind:class="'icon-monitor '+(screenShareEnabled ? 'active' : '')"
              v-on:click="screenShareToggle"
            ></button>
            <button v-bind:class="'icon-exit'" v-on:click="exit"></button>
            <button
              v-bind:class="'icon-more-horizontal '+(showSettings ? 'active' : '')"
              v-on:click="showSettings = !showSettings"
            ></button>
          </div>
        </div>
      </div>
    </main>
  </body>
</html>
